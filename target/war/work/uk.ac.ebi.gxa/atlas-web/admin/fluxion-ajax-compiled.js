var Fluxion={};Fluxion.version=20091106;Fluxion.doAjax=function(d,l,n,i){i||(i={"":""});n||(n={"":""});var f="ajax.web";if(n.url&&n.url!="")f=n.url;f=new Fluxion.Ajax.newAjax(f);if(i.passthrough){f.doAjax(d,l,n,i);return f.getPassthroughResponse()}else if(i.ajaxType&&i.ajaxType=="periodical"){f.doAjax(d,l,n,i);return f.getProgressUpdater()}else return f.doAjax(d,l,n,i)}; Fluxion.doAjaxUpload=function(d,l,n,i,f,m){f||(f={"":""});i||(i={"":""});m||(m={"":""});var o="ajax.web";if(i.url&&i.url!="")o=i.url;return(new Fluxion.Ajax.newAjaxUpload(o,d)).doAjaxUpload(l,n,i,f,m)};Fluxion.Ajax={}; Fluxion.Ajax.newAjax=function(d){var l=this;l.passthrough={};l.pu=null;this.getProgressUpdater=function(){return l.pu};this.getPassthroughResponse=function(){return l.passthrough.response};var n=function(f){if(f.error)alert("Error: "+decodeResponse(f.error));else if(f.response)l.passthrough.response=decodeResponse(f.response)},i=function(){l.pu.stop()};this.doAjax=function(f,m,o,c){if(c&&c.ajaxType&&c.ajaxType=="periodical"){var p="FRAME-"+Math.floor(Math.random()*99999),b=document.createElement("iframe"); b.setAttribute("id",p);b.setAttribute("name",p);b.setAttribute("src","");b.setAttribute("style","width:0;height:0;visibility:hidden;");b.style.cssText="width:0;height:0;visibility:hidden;";document.getElementsByTagName("body")[0].appendChild(b);var g=b=1;if(c.updateFrequency)b=c.updateFrequency;if(c.updateDecay)g=c.updateDecay;l.pu=new Ajax.PeriodicalUpdater(p,d,{method:"post",postBody:"servicename="+f+"&action="+m+"&params="+encodeURIComponent(JSON.stringify(o)),onLoading:function(){c.doOnLoading&& processJavascript(c.doOnLoading)},onSuccess:function(a){a=JSON.parse(a.responseText);if(c.passthrough)n(a);else if(a.error){alert("Error: "+a.error);i()}else{a.stopUpdater&&i();if(c.updateElement){a.response=decodeResponse(a.response);c&&c.updateElement&&processOutputJSON(c.updateElement,a.response)}if(a.doOnSuccess)if(Object.prototype.toString.apply(a.doOnSuccess)==="[object Array]")for(var k=a.doOnSuccess,h=0;h<k.length;h++)processJavascript(k[h]);else processJavascript(a.doOnSuccess);if(c.doOnSuccess)if(Object.prototype.toString.apply(c.doOnSuccess)=== "[object Array]")for(h=0;h<c.doOnSuccess.length;h++)c.doOnSuccess[h](a);else c.doOnSuccess(a)}},frequency:b,decay:g,onFailure:errFunc})}else new Ajax.Request(d,{method:"post",postBody:"servicename="+f+"&action="+m+"&params="+encodeURIComponent(JSON.stringify(o)),onLoading:function(){c&&c.doOnLoading&&c.doOnLoading()},onSuccess:function(a){a=JSON.parse(a.responseText);if(c&&c.passthrough)n(a);else if(a.error)alert("Error: "+decodeResponse(a.error));else{c&&c.updateElement&&a.response&&processOutputJSON(c.updateElement, decodeResponse(a.response));if(a.doOnSuccess)if(Object.prototype.toString.apply(a.doOnSuccess)==="[object Array]")for(var k=a.doOnSuccess,h=0;h<k.length;h++)processJavascript(k[h]);else processJavascript(a.doOnSuccess);if(c&&c.doOnSuccess)if(Object.prototype.toString.apply(c.doOnSuccess)==="[object Array]")for(h=0;h<c.doOnSuccess.length;h++)c.doOnSuccess[h](a);else c.doOnSuccess(a)}},onFailure:errFunc})}}; var decodeResponse=function(d){return decodeURIComponent(d.replace(/\+/g,"%20"))},processJavascript=function(d){("<script>"+d+"<\/script>").evalScripts()},processOutputJSON=function(d,l){$(d).innerHTML=l},errFunc=function(d){alert("Error "+d.status+" -- "+d.statusText)}; Fluxion.Ajax.newAjaxUpload=function(d,l){function n(){c=document.createElement("div");c.setAttribute("id",m);p=document.createElement("iframe");p.setAttribute("id",o);p.setAttribute("name",o);p.setAttribute("src","");p.setAttribute("style","width:0;height:0;visibility:hidden;");p.style.cssText="width:0;height:0;visibility:hidden;";c.appendChild(p);$(l).appendChild(c);if(!frames[o].id)frames[o].id=o;if(!frames[o].name)frames[o].name=o}var i=false,f,m="CONTAINER-"+Math.floor(Math.random()*99999),o= "FRAME-"+Math.floor(Math.random()*99999),c=null,p=null;$(l).setAttribute("target",o);n();this.doAjaxUpload=function(b,g,a,k,h){f=new Ajax.PeriodicalUpdater(k.progressElement,d,{asynchronous:true,onSuccess:function(j){j=JSON.parse(j.responseText);if(j.error!=null)alert("Error: "+j.error);else if(!i){var e=0;if(j.bytes_read&&j.content_length)e=100*(j.bytes_read/j.content_length);if(e!=100)$(k.statusElement).innerHTML="Uploading: "+e+"% complete...<br/>";else{$(k.statusElement).innerHTML="Upload complete<br/>"; new Effect.Highlight($(k.statusElement));f.stop();i=true;h&&doValidation(h)}}},frequency:1,method:"post",postBody:"servicename="+b+"&action="+g+"&params="+encodeURIComponent(JSON.stringify(a)),onFailure:errFunc})}};var doValidation=function(d){return(new Fluxion.Ajax.newAjax("ajax.web")).doAjax(d.validationBeanId,"validate",d,null)},JSON=JSON||{}; (function(){function d(b){return b<10?"0"+b:b}function l(b){f.lastIndex=0;return f.test(b)?'"'+b.replace(f,function(g){var a=c[g];return typeof a==="string"?a:"\\u"+("0000"+g.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+b+'"'}function n(b,g){var a,k,h=m,j,e=g[b];if(e&&typeof e==="object"&&typeof e.toJSON==="function")e=e.toJSON(b);if(typeof p==="function")e=p.call(g,b,e);switch(typeof e){case "string":return l(e);case "number":return isFinite(e)?String(e):"null";case "boolean":case "null":return String(e); case "object":if(!e)return"null";m+=o;j=[];if(Object.prototype.toString.apply(e)==="[object Array]"){k=e.length;for(b=0;b<k;b+=1)j[b]=n(b,e)||"null";g=j.length===0?"[]":m?"[\n"+m+j.join(",\n"+m)+"\n"+h+"]":"["+j.join(",")+"]";m=h;return g}if(p&&typeof p==="object"){k=p.length;for(b=0;b<k;b+=1){a=p[b];if(typeof a==="string")if(g=n(a,e))j.push(l(a)+(m?": ":":")+g)}}else for(a in e)if(Object.hasOwnProperty.call(e,a))if(g=n(a,e))j.push(l(a)+(m?": ":":")+g);g=j.length===0?"{}":m?"{\n"+m+j.join(",\n"+m)+ "\n"+h+"}":"{"+j.join(",")+"}";m=h;return g}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return this.getUTCFullYear()+"-"+d(this.getUTCMonth()+1)+"-"+d(this.getUTCDate())+"T"+d(this.getUTCHours())+":"+d(this.getUTCMinutes())+":"+d(this.getUTCSeconds())+"Z"};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var i=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g, f=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,m,o,c={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},p;if(typeof JSON.stringify!=="function")JSON.stringify=function(b,g,a){var k;o=m="";if(typeof a==="number")for(k=0;k<a;k+=1)o+=" ";else if(typeof a==="string")o=a;if((p=g)&&typeof g!=="function"&&(typeof g!=="object"||typeof g.length!=="number"))throw new Error("JSON.stringify");return n("", {"":b})};if(typeof JSON.parse!=="function")JSON.parse=function(b,g){function a(k,h){var j,e,q=k[h];if(q&&typeof q==="object")for(j in q)if(Object.hasOwnProperty.call(q,j)){e=a(q,j);if(e!==undefined)q[j]=e;else delete q[j]}return g.call(k,h,q)}i.lastIndex=0;if(i.test(b))b=b.replace(i,function(k){return"\\u"+("0000"+k.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(b.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g, "]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){b=eval("("+b+")");return typeof g==="function"?a({"":b},""):b}throw new SyntaxError("JSON.parse");}})();String.prototype.trim=function(){var d=this;d=d.replace(/^\s*(.*)/,"$1");return d=d.replace(/(.*?)\s*$/,"$1")};
